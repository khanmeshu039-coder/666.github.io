<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è°æ˜¯å§åº• - èšä¼šæ¸¸æˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- é…ç½®Tailwindè‡ªå®šä¹‰é¢œè‰²å’Œå­—ä½“ -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1E40AF', // æ·±è“ä¸»è‰²è°ƒ
                        secondary: '#3B82F6', // äº®è“è¾…åŠ©è‰²
                        accent: '#F59E0B', // æ©™è‰²å¼ºè°ƒè‰²
                        dark: '#1E293B', // æ·±è‰²èƒŒæ™¯
                        light: '#F8FAFC'  // æµ…è‰²èƒŒæ™¯
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            .card-hover {
                @apply transition-all duration-300 hover:shadow-lg hover:-translate-y-1;
            }
            .btn-primary {
                @apply bg-primary text-white font-medium py-3 px-6 rounded-lg shadow-md transition-all duration-300 hover:bg-primary/90 active:scale-95;
            }
            .btn-accent {
                @apply bg-accent text-white font-medium py-3 px-6 rounded-lg shadow-md transition-all duration-300 hover:bg-accent/90 active:scale-95;
            }
            .btn-outline {
                @apply border-2 border-primary text-primary font-medium py-3 px-6 rounded-lg transition-all duration-300 hover:bg-primary/10 active:scale-95;
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-dark to-primary min-h-screen text-light font-sans overflow-x-hidden">
    <!-- é¡µé¢å®¹å™¨ -->
    <div class="container mx-auto px-4 py-8 max-w-md">
        <!-- æ¸¸æˆæ ‡é¢˜ -->
        <div class="text-center mb-8 pt-4">
            <h1 class="text-[clamp(2rem,5vw,3rem)] font-bold text-shadow text-transparent bg-clip-text bg-gradient-to-r from-secondary to-accent">
                è°æ˜¯å§åº•
            </h1>
            <p class="text-gray-300 mt-2">èšä¼šå¿…å¤‡ Â· ç¦»çº¿ç•…ç©</p>
        </div>
        
        <!-- å¼€å§‹ç•Œé¢ -->
        <div id="start-screen" class="transition-all duration-500">
            <div class="bg-dark/60 backdrop-blur-sm rounded-xl p-6 shadow-xl mb-6">
                <h2 class="text-xl font-bold mb-4 text-center">æ¸¸æˆè®¾ç½®</h2>
                
                <!-- ç©å®¶äººæ•°é€‰æ‹© -->
                <div class="mb-6">
                    <label class="block text-gray-300 mb-2">ç©å®¶äººæ•°</label>
                    <div class="flex items-center justify-between bg-dark/80 rounded-lg p-3">
                        <button id="decrease-players" class="w-10 h-10 flex items-center justify-center rounded-full bg-primary/20 hover:bg-primary/40 transition-colors">
                            <i class="fa fa-minus"></i>
                        </button>
                        <span id="player-count" class="text-2xl font-bold">6</span>
                        <button id="increase-players" class="w-10 h-10 flex items-center justify-center rounded-full bg-primary/20 hover:bg-primary/40 transition-colors">
                            <i class="fa fa-plus"></i>
                        </button>
                    </div>
                    <p class="text-xs text-gray-400 mt-1 text-center">æœ€å°‘3äººï¼Œæœ€å¤š12äºº</p>
                </div>
                
                <!-- å§åº•äººæ•°é€‰æ‹© -->
                <div class="mb-6">
                    <label class="block text-gray-300 mb-2">å§åº•äººæ•°</label>
                    <div class="flex items-center justify-between bg-dark/80 rounded-lg p-3">
                        <button id="decrease-spies" class="w-10 h-10 flex items-center justify-center rounded-full bg-primary/20 hover:bg-primary/40 transition-colors">
                            <i class="fa fa-minus"></i>
                        </button>
                        <span id="spy-count" class="text-2xl font-bold">1</span>
                        <button id="increase-spies" class="w-10 h-10 flex items-center justify-center rounded-full bg-primary/20 hover:bg-primary/40 transition-colors">
                            <i class="fa fa-plus"></i>
                        </button>
                    </div>
                    <p class="text-xs text-gray-400 mt-1 text-center">æœ€å¤šä¸ºç©å®¶æ•°çš„ä¸€åŠ</p>
                </div>
                
                <button id="start-game" class="btn-primary w-full flex items-center justify-center">
                    <i class="fa fa-play mr-2"></i> å¼€å§‹æ¸¸æˆ
                </button>
            </div>
            
            <div class="bg-dark/40 backdrop-blur-sm rounded-xl p-5 text-center">
                <h3 class="font-bold mb-2">æ¸¸æˆè§„åˆ™</h3>
                <p class="text-sm text-gray-300">
                    ç©å®¶åˆ†ä¸ºå¹³æ°‘å’Œå§åº•ï¼Œå„è‡ªè·å¾—ä¸åŒä½†ç›¸å…³çš„è¯è¯­ã€‚è½®æµæè¿°åï¼Œæ‰€æœ‰ç©å®¶åŒæ—¶æŠ•ç¥¨ï¼Œå¾—ç¥¨æœ€å¤šè€…å‡ºå±€ï¼Œç›´åˆ°åˆ†å‡ºèƒœè´Ÿã€‚
                </p>
            </div>
        </div>
        
        <!-- è¯è¯­æŸ¥çœ‹ç•Œé¢ -->
        <div id="word-screen" class="hidden transition-all duration-500">
            <div class="bg-dark/60 backdrop-blur-sm rounded-xl p-6 shadow-xl mb-6 text-center relative">
                <!-- é˜²å·çœ‹é®æŒ¡å±‚ -->
                <div id="word-overlay" class="absolute inset-0 bg-dark/95 rounded-xl flex flex-col items-center justify-center z-10 hidden">
                    <p class="text-xl mb-4">è¯·å°†è®¾å¤‡äº¤ç»™ <span id="overlay-next-player" class="text-accent font-bold"></span></p>
                    <p class="text-gray-400 mb-6">ä»–ä»¬éœ€è¦ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æŸ¥çœ‹è‡ªå·±çš„è¯è¯­</p>
                    <button id="overlay-confirm" class="btn-primary">
                        æˆ‘å·²å‡†å¤‡å¥½æŸ¥çœ‹ <i class="fa fa-eye ml-2"></i>
                    </button>
                </div>
                
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold">å½“å‰ç©å®¶</h2>
                    <span id="current-player-indicator" class="bg-accent/30 text-accent px-3 py-1 rounded-full text-sm font-medium">
                        ç©å®¶1
                    </span>
                </div>
                
                <h3 class="text-lg font-medium mb-4">ä½ çš„è¯è¯­</h3>
                <div class="my-8 p-6 bg-primary/30 rounded-lg border-2 border-secondary/50">
                    <p id="player-word" class="text-3xl font-bold"></p>
                </div>
                <p class="text-gray-300 mb-2">è®°ä½ä½ çš„è¯è¯­ï¼Œä¸è¦è®©åˆ«äººçŸ¥é“å“¦ï¼</p>
                <p class="text-gray-400 text-sm mb-6">
                    <span id="remaining-players-count">5</span> ä½ç©å®¶ç­‰å¾…æŸ¥çœ‹
                </p>
                
                <button id="next-player" class="btn-primary w-full">
                    ä¼ ç»™ä¸‹ä¸€ä½ <i class="fa fa-arrow-right ml-2"></i>
                </button>
            </div>
            
            <div class="text-center text-gray-400 text-sm">
                <p>æç¤ºï¼šçœ‹å®Œåè¯·å°†è®¾å¤‡äº¤ç»™ä¸‹ä¸€ä½ç©å®¶</p>
            </div>
        </div>
        
        <!-- æ¸¸æˆç•Œé¢ -->
        <div id="game-screen" class="hidden transition-all duration-500">
            <div class="bg-dark/60 backdrop-blur-sm rounded-xl p-6 shadow-xl mb-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold">æ¸¸æˆè¿›è¡Œä¸­</h2>
                    <div class="flex space-x-2">
                        <button id="restart-game" class="btn-outline py-2 px-4 text-sm">
                            <i class="fa fa-refresh mr-1"></i> é‡å¼€
                        </button>
                    </div>
                </div>
                
                <!-- ç©å®¶åˆ—è¡¨ -->
                <div class="mb-6">
                    <h3 class="text-gray-300 mb-3">ç©å®¶çŠ¶æ€</h3>
                    <div id="players-list" class="grid grid-cols-3 gap-2">
                        <!-- ç©å®¶ä¼šåŠ¨æ€ç”Ÿæˆåœ¨è¿™é‡Œ -->
                    </div>
                </div>
                
                <!-- æ¸¸æˆçŠ¶æ€ -->
                <div id="game-status" class="bg-dark/80 rounded-lg p-4 mb-6 text-center">
                    <p class="text-lg">è¯·è½®æµæè¿°è‡ªå·±çš„è¯è¯­</p>
                </div>
                
                <button id="start-vote" class="btn-accent w-full">
                    <i class="fa fa-hand-paper-o mr-2"></i> å¼€å§‹æŠ•ç¥¨
                </button>
            </div>
        </div>
        
        <!-- æŠ•ç¥¨ç•Œé¢ -->
        <div id="vote-screen" class="hidden transition-all duration-500">
            <div class="bg-dark/60 backdrop-blur-sm rounded-xl p-6 shadow-xl mb-6">
                <h2 class="text-xl font-bold mb-4 text-center">æŠ•ç¥¨é˜¶æ®µ</h2>
                <p class="text-gray-300 text-center mb-4">è¯·æ‰€æœ‰ç©å®¶ä¾æ¬¡é€‰æ‹©æ€€ç–‘çš„å¯¹è±¡</p>
                <p class="text-gray-400 text-sm text-center mb-2">å½“å‰è¿›åº¦: <span id="vote-progress" class="text-accent font-medium">0/6</span></p>
                <p class="text-gray-400 text-sm text-center mb-6">æç¤ºï¼šæ¯ä½ç©å®¶é€‰æ‹©åæäº¤ï¼Œç„¶åä¼ ç»™ä¸‹ä¸€ä½</p>
                
                <!-- æŠ•ç¥¨åˆ—è¡¨ -->
                <div id="voting-list" class="grid grid-cols-3 gap-2 mb-6">
                    <!-- å¯æŠ•ç¥¨çš„ç©å®¶ä¼šåŠ¨æ€ç”Ÿæˆåœ¨è¿™é‡Œ -->
                </div>
                
                <div class="flex space-x-3">
                    <button id="cancel-vote" class="btn-outline flex-1">
                        <i class="fa fa-times mr-1"></i> å–æ¶ˆ
                    </button>
                    <button id="submit-vote" class="btn-accent flex-1" disabled>
                        <i class="fa fa-check mr-1"></i> æäº¤
                    </button>
                </div>
            </div>
        </div>
        
        <!-- æŠ•ç¥¨ç»“æœç•Œé¢ -->
        <div id="vote-result-screen" class="hidden transition-all duration-500">
            <div class="bg-dark/60 backdrop-blur-sm rounded-xl p-6 shadow-xl mb-6 text-center">
                <h2 class="text-xl font-bold mb-4">æŠ•ç¥¨ç»“æœ</h2>
                
                <div id="vote-tally" class="my-4 space-y-2 max-h-40 overflow-y-auto p-2">
                    <!-- æŠ•ç¥¨ç»Ÿè®¡ä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ -->
                </div>
                
                <div id="elimination-result" class="my-6 p-4 rounded-lg bg-primary/20">
                    <!-- æŠ•ç¥¨ç»“æœä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ -->
                </div>
                
                <div class="flex space-x-3">
                    <button id="show-eliminated-role" class="btn-outline flex-1 py-2">
                        <i class="fa fa-eye mr-1"></i> æŸ¥çœ‹èº«ä»½
                    </button>
                    <button id="continue-game" class="btn-primary flex-1 py-2">
                        ç»§ç»­æ¸¸æˆ <i class="fa fa-arrow-right mr-1"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- æ¸¸æˆç»“æŸç•Œé¢ -->
        <div id="end-screen" class="hidden transition-all duration-500">
            <div class="bg-dark/60 backdrop-blur-sm rounded-xl p-6 shadow-xl mb-6 text-center">
                <h2 id="winner-text" class="text-2xl font-bold mb-4"></h2>
                
                <div id="game-summary" class="my-6 space-y-4">
                    <!-- æ¸¸æˆæ€»ç»“ä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ -->
                </div>
                
                <div class="mt-8">
                    <button id="play-again" class="btn-primary w-full">
                        <i class="fa fa-refresh mr-2"></i> å†æ¥ä¸€å±€
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ¸¸æˆæ•°æ®
        const gameData = {
            totalPlayers: 6,
            totalSpies: 1,
            currentPlayerIndex: 0, // ç”¨äºè½®æµæŸ¥çœ‹è¯è¯­
            players: [],
            words: {
                civilian: "",
                spy: ""
            },
            eliminatedPlayers: [],
            votes: [],
            votedPlayers: [] // è®°å½•å·²æŠ•ç¥¨çš„ç©å®¶ID
        };
        
        // è¯è¯­åº“ - å¹³æ°‘è¯å’Œå§åº•è¯çš„é…å¯¹
        const wordPairs = [
            { civilian: "ç‰›å¥¶", spy: "è±†æµ†" },
            { civilian: "ç«é”…", spy: "éº»è¾£çƒ«" },
            { civilian: "æ‰‹æœº", spy: "å¹³æ¿" },
            { civilian: "è‡ªè¡Œè½¦", spy: "ç”µåŠ¨è½¦" },
            { civilian: "æ±‰å ¡", spy: "ä¸‰æ˜æ²»" },
            { civilian: "ç©ºè°ƒ", spy: "ç”µé£æ‰‡" },
            { civilian: "ç™½èœ", spy: "é’èœ" },
            { civilian: "é’¢ç¬”", spy: "é“…ç¬”" },
            { civilian: "è¶³çƒ", spy: "ç¯®çƒ" },
            { civilian: "ç™½é…’", spy: "å•¤é…’" },
            { civilian: "ç«è½¦", spy: "é«˜é“" },
            { civilian: "ç±³é¥­", spy: "é¢æ¡" },
            { civilian: "å’–å•¡", spy: "èŒ¶" },
            { civilian: "è¡¬è¡«", spy: "Tæ¤" },
            { civilian: "å›¾ä¹¦é¦†", spy: "ä¹¦åº—" }
        ];
        
        // DOM å…ƒç´ 
        const elements = {
            startScreen: document.getElementById('start-screen'),
            wordScreen: document.getElementById('word-screen'),
            gameScreen: document.getElementById('game-screen'),
            voteScreen: document.getElementById('vote-screen'),
            voteResultScreen: document.getElementById('vote-result-screen'),
            endScreen: document.getElementById('end-screen'),
            
            // é˜²å·çœ‹ç›¸å…³å…ƒç´ 
            wordOverlay: document.getElementById('word-overlay'),
            overlayNextPlayer: document.getElementById('overlay-next-player'),
            overlayConfirm: document.getElementById('overlay-confirm'),
            
            playerCount: document.getElementById('player-count'),
            spyCount: document.getElementById('spy-count'),
            decreasePlayers: document.getElementById('decrease-players'),
            increasePlayers: document.getElementById('increase-players'),
            decreaseSpies: document.getElementById('decrease-spies'),
            increaseSpies: document.getElementById('increase-spies'),
            
            startGame: document.getElementById('start-game'),
            nextPlayer: document.getElementById('next-player'),
            startVote: document.getElementById('start-vote'),
            cancelVote: document.getElementById('cancel-vote'),
            submitVote: document.getElementById('submit-vote'),
            restartGame: document.getElementById('restart-game'),
            continueGame: document.getElementById('continue-game'),
            showEliminatedRole: document.getElementById('show-eliminated-role'),
            playAgain: document.getElementById('play-again'),
            
            playerWord: document.getElementById('player-word'),
            currentPlayerIndicator: document.getElementById('current-player-indicator'),
            remainingPlayersCount: document.getElementById('remaining-players-count'),
            voteProgress: document.getElementById('vote-progress'),
            playersList: document.getElementById('players-list'),
            votingList: document.getElementById('voting-list'),
            gameStatus: document.getElementById('game-status'),
            eliminationResult: document.getElementById('elimination-result'),
            voteTally: document.getElementById('vote-tally'),
            winnerText: document.getElementById('winner-text'),
            gameSummary: document.getElementById('game-summary')
        };
        
        // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
        function initEventListeners() {
            // ç©å®¶æ•°é‡è°ƒæ•´
            elements.decreasePlayers.addEventListener('click', () => {
                if (gameData.totalPlayers > 3) {
                    gameData.totalPlayers--;
                    updatePlayerCount();
                    updateMaxSpies();
                }
            });
            
            elements.increasePlayers.addEventListener('click', () => {
                if (gameData.totalPlayers < 12) {
                    gameData.totalPlayers++;
                    updatePlayerCount();
                    updateMaxSpies();
                }
            });
            
            // å§åº•æ•°é‡è°ƒæ•´
            elements.decreaseSpies.addEventListener('click', () => {
                if (gameData.totalSpies > 1) {
                    gameData.totalSpies--;
                    updateSpyCount();
                }
            });
            
            elements.increaseSpies.addEventListener('click', () => {
                if (gameData.totalSpies < Math.floor(gameData.totalPlayers / 2)) {
                    gameData.totalSpies++;
                    updateSpyCount();
                }
            });
            
            // æ¸¸æˆæ§åˆ¶
            elements.startGame.addEventListener('click', startGame);
            elements.nextPlayer.addEventListener('click', nextPlayer);
            elements.startVote.addEventListener('click', showVoteScreen);
            elements.cancelVote.addEventListener('click', showGameScreen);
            elements.submitVote.addEventListener('click', processVote);
            elements.restartGame.addEventListener('click', restartGame);
            elements.continueGame.addEventListener('click', checkGameStatus);
            elements.showEliminatedRole.addEventListener('click', showEliminatedRole);
            elements.playAgain.addEventListener('click', restartGame);
            
            // é˜²å·çœ‹ç›¸å…³
            elements.overlayConfirm.addEventListener('click', () => {
                elements.wordOverlay.classList.add('hidden');
                showCurrentPlayerWord();
            });
        }
        
        // æ›´æ–°ç©å®¶æ•°é‡æ˜¾ç¤º
        function updatePlayerCount() {
            elements.playerCount.textContent = gameData.totalPlayers;
        }
        
        // æ›´æ–°å§åº•æ•°é‡æ˜¾ç¤º
        function updateSpyCount() {
            elements.spyCount.textContent = gameData.totalSpies;
        }
        
        // æ›´æ–°æœ€å¤§å§åº•æ•°é‡é™åˆ¶
        function updateMaxSpies() {
            const maxSpies = Math.floor(gameData.totalPlayers / 2);
            if (gameData.totalSpies > maxSpies) {
                gameData.totalSpies = maxSpies;
                updateSpyCount();
            }
        }
        
        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            // é‡ç½®æ¸¸æˆæ•°æ®
            gameData.players = [];
            gameData.eliminatedPlayers = [];
            gameData.votes = [];
            gameData.votedPlayers = [];
            gameData.currentPlayerIndex = 0;
            
            // éšæœºé€‰æ‹©è¯è¯­å¯¹
            const randomPair = wordPairs[Math.floor(Math.random() * wordPairs.length)];
            gameData.words.civilian = randomPair.civilian;
            gameData.words.spy = randomPair.spy;
            
            // åˆ›å»ºç©å®¶
            for (let i = 0; i < gameData.totalPlayers; i++) {
                gameData.players.push({
                    id: i,
                    name: `ç©å®¶${i + 1}`,
                    isSpy: i < gameData.totalSpies,
                    isEliminated: false,
                    hasViewedWord: false
                });
            }
            
            // æ‰“ä¹±ç©å®¶é¡ºåºï¼ˆä½¿å§åº•ä½ç½®éšæœºï¼‰
            shuffleArray(gameData.players);
            
            // æ˜¾ç¤ºç¬¬ä¸€ä½ç©å®¶çš„è¯è¯­ï¼ˆæ— é®æŒ¡ï¼‰
            elements.wordOverlay.classList.add('hidden');
            showCurrentPlayerWord();
            
            // æ˜¾ç¤ºè¯è¯­ç•Œé¢
            showWordScreen();
        }
        
        // æ˜¾ç¤ºå½“å‰ç©å®¶çš„è¯è¯­
        function showCurrentPlayerWord() {
            const currentPlayer = gameData.players[gameData.currentPlayerIndex];
            elements.playerWord.textContent = currentPlayer.isSpy 
                ? gameData.words.spy 
                : gameData.words.civilian;
                
            elements.currentPlayerIndicator.textContent = currentPlayer.name;
            currentPlayer.hasViewedWord = true;
            
            // æ›´æ–°å‰©ä½™ç©å®¶æ•°é‡
            const remaining = gameData.players.filter(p => !p.hasViewedWord).length;
            elements.remainingPlayersCount.textContent = remaining;
        }
        
        // åˆ‡æ¢åˆ°ä¸‹ä¸€ä½ç©å®¶æŸ¥çœ‹è¯è¯­
        function nextPlayer() {
            // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰ç©å®¶éƒ½å·²æŸ¥çœ‹è¯è¯­
            const allViewed = gameData.players.every(p => p.hasViewedWord);
            
            if (allViewed) {
                // æ‰€æœ‰ç©å®¶éƒ½å·²æŸ¥çœ‹ï¼Œè¿›å…¥æ¸¸æˆç•Œé¢
                showGameScreen();
            } else {
                // æ‰¾åˆ°ä¸‹ä¸€ä¸ªæœªæŸ¥çœ‹è¯è¯­çš„ç©å®¶
                let nextIndex;
                do {
                    nextIndex = (gameData.currentPlayerIndex + 1) % gameData.players.length;
                } while (gameData.players[nextIndex].hasViewedWord);
                
                // æ˜¾ç¤ºé®æŒ¡å±‚ï¼Œå‡†å¤‡åˆ‡æ¢ç©å®¶
                elements.overlayNextPlayer.textContent = gameData.players[nextIndex].name;
                elements.wordOverlay.classList.remove('hidden');
                
                // éšè—å½“å‰è¯è¯­
                elements.playerWord.textContent = '';
                
                // æ›´æ–°å½“å‰ç©å®¶ç´¢å¼•
                gameData.currentPlayerIndex = nextIndex;
            }
        }
        
        // æ˜¾ç¤ºè¯è¯­ç•Œé¢
        function showWordScreen() {
            hideAllScreens();
            elements.wordScreen.classList.remove('hidden');
            
            // æ·»åŠ å…¥åœºåŠ¨ç”»
            elements.wordScreen.classList.add('animate-fadeIn');
            setTimeout(() => {
                elements.wordScreen.classList.remove('animate-fadeIn');
            }, 500);
        }
        
        // æ˜¾ç¤ºæ¸¸æˆç•Œé¢
        function showGameScreen() {
            hideAllScreens();
            elements.gameScreen.classList.remove('hidden');
            
            // æ›´æ–°ç©å®¶åˆ—è¡¨
            updatePlayersList();
            
            // æ·»åŠ å…¥åœºåŠ¨ç”»
            elements.gameScreen.classList.add('animate-fadeIn');
            setTimeout(() => {
                elements.gameScreen.classList.remove('animate-fadeIn');
            }, 500);
        }
        
        // æ˜¾ç¤ºæŠ•ç¥¨ç•Œé¢
        function showVoteScreen() {
            hideAllScreens();
            elements.voteScreen.classList.remove('hidden');
            
            // é‡ç½®æŠ•ç¥¨
            gameData.votes = [];
            gameData.votedPlayers = [];
            elements.submitVote.disabled = true;
            
            // æ›´æ–°æŠ•ç¥¨è¿›åº¦
            updateVoteProgress();
            
            // æ›´æ–°æŠ•ç¥¨åˆ—è¡¨
            updateVotingList();
            
            // æ·»åŠ å…¥åœºåŠ¨ç”»
            elements.voteScreen.classList.add('animate-fadeIn');
            setTimeout(() => {
                elements.voteScreen.classList.remove('animate-fadeIn');
            }, 500);
        }
        
        // æ›´æ–°æŠ•ç¥¨è¿›åº¦
        function updateVoteProgress() {
            const remainingPlayers = gameData.players.filter(p => !p.isEliminated).length;
            elements.voteProgress.textContent = `${gameData.votes.length}/${remainingPlayers}`;
        }
        
        // æ˜¾ç¤ºæŠ•ç¥¨ç»“æœç•Œé¢
        function showVoteResultScreen(eliminatedPlayer, voteCounts) {
            hideAllScreens();
            elements.voteResultScreen.classList.remove('hidden');
            
            // æ˜¾ç¤ºæŠ•ç¥¨ç»Ÿè®¡
            let tallyHtml = '';
            for (const [playerId, count] of Object.entries(voteCounts)) {
                const player = gameData.players.find(p => p.id === parseInt(playerId));
                tallyHtml += `
                    <div class="flex justify-between items-center p-2 bg-dark/50 rounded">
                        <span>${player.name}</span>
                        <span class="flex items-center">
                            ${'ğŸ—³ï¸'.repeat(count)} ${count}ç¥¨
                        </span>
                    </div>
                `;
            }
            elements.voteTally.innerHTML = tallyHtml;
            
            // æ˜¾ç¤ºè¢«æ·˜æ±°çš„ç©å®¶
            elements.eliminationResult.innerHTML = `
                <p class="text-lg mb-2">${eliminatedPlayer.name} è¢«æ·˜æ±°äº†</p>
                <p class="text-gray-300" id="role-reveal" style="display: none;">
                    èº«ä»½: ${eliminatedPlayer.isSpy ? 'å§åº•' : 'å¹³æ°‘'}
                </p>
            `;
            
            // æ·»åŠ å…¥åœºåŠ¨ç”»
            elements.voteResultScreen.classList.add('animate-fadeIn');
            setTimeout(() => {
                elements.voteResultScreen.classList.remove('animate-fadeIn');
            }, 500);
        }
        
        // æ˜¾ç¤ºå¹³å±€æç¤ºç•Œé¢
        function showTieVoteScreen() {
            hideAllScreens();
            elements.voteResultScreen.classList.remove('hidden');
            
            // æ˜¾ç¤ºå¹³å±€ä¿¡æ¯
            elements.voteTally.innerHTML = '<p class="text-center py-2">å‡ºç°ç¥¨æ•°ç›¸åŒçš„æƒ…å†µ</p>';
            elements.eliminationResult.innerHTML = `
                <p class="text-lg mb-2">æŠ•ç¥¨ç»“æœå¹³å±€</p>
                <p class="text-gray-300">éœ€è¦é‡æ–°æŠ•ç¥¨</p>
            `;
            
            // ä¿®æ”¹æŒ‰é’®æ–‡æœ¬
            elements.showEliminatedRole.classList.add('hidden');
            elements.continueGame.textContent = 'é‡æ–°æŠ•ç¥¨';
            
            // æ·»åŠ å…¥åœºåŠ¨ç”»
            elements.voteResultScreen.classList.add('animate-fadeIn');
            setTimeout(() => {
                elements.voteResultScreen.classList.remove('animate-fadeIn');
            }, 500);
        }
        
        // æ˜¾ç¤ºæ¸¸æˆç»“æŸç•Œé¢
        function showEndScreen(isSpiesWon) {
            hideAllScreens();
            elements.endScreen.classList.remove('hidden');
            
            // æ˜¾ç¤ºè·èƒœæ–¹
            elements.winnerText.textContent = isSpiesWon ? 'å§åº•èƒœåˆ©ï¼' : 'å¹³æ°‘èƒœåˆ©ï¼';
            elements.winnerText.className = isSpiesWon 
                ? 'text-2xl font-bold mb-4 text-accent' 
                : 'text-2xl font-bold mb-4 text-secondary';
            
            // æ˜¾ç¤ºæ¸¸æˆæ€»ç»“
            let summaryHtml = `
                <div class="p-3 bg-primary/20 rounded-lg">
                    <p class="font-medium">å¹³æ°‘è¯: ${gameData.words.civilian}</p>
                    <p class="font-medium">å§åº•è¯: ${gameData.words.spy}</p>
                </div>
                <div>
                    <p class="font-medium mb-2">ç©å®¶èº«ä»½:</p>
                    <div class="grid grid-cols-2 gap-2">
            `;
            
            gameData.players.forEach(player => {
                summaryHtml += `
                    <div class="flex items-center justify-between p-2 rounded-lg ${player.isEliminated ? 'bg-gray-700/50' : 'bg-primary/10'}">
                        <span>${player.name}</span>
                        <span class="${player.isSpy ? 'text-accent' : 'text-secondary'}">
                            ${player.isSpy ? 'å§åº•' : 'å¹³æ°‘'}
                        </span>
                    </div>
                `;
            });
            
            summaryHtml += `
                    </div>
                </div>
            `;
            
            elements.gameSummary.innerHTML = summaryHtml;
            
            // æ·»åŠ å…¥åœºåŠ¨ç”»
            elements.endScreen.classList.add('animate-fadeIn');
            setTimeout(() => {
                elements.endScreen.classList.remove('animate-fadeIn');
            }, 500);
        }
        
        // éšè—æ‰€æœ‰ç•Œé¢
        function hideAllScreens() {
            elements.startScreen.classList.add('hidden');
            elements.wordScreen.classList.add('hidden');
            elements.gameScreen.classList.add('hidden');
            elements.voteScreen.classList.add('hidden');
            elements.voteResultScreen.classList.add('hidden');
            elements.endScreen.classList.add('hidden');
            
            // é‡ç½®å¹³å±€çŠ¶æ€çš„æŒ‰é’®
            elements.showEliminatedRole.classList.remove('hidden');
            elements.continueGame.innerHTML = 'ç»§ç»­æ¸¸æˆ <i class="fa fa-arrow-right mr-1"></i>';
        }
        
        // æ›´æ–°ç©å®¶åˆ—è¡¨æ˜¾ç¤º
        function updatePlayersList() {
            elements.playersList.innerHTML = '';
            
            gameData.players.forEach(player => {
                const playerElement = document.createElement('div');
                playerElement.className = `
                    flex flex-col items-center justify-center p-3 rounded-lg text-center card-hover
                    ${player.isEliminated 
                        ? 'bg-gray-700/50 text-gray-400 line-through' 
                        : player.isSpy 
                            ? 'bg-accent/20' 
                            : 'bg-secondary/20'}
                `;
                
                playerElement.innerHTML = `
                    <div class="w-10 h-10 rounded-full flex items-center justify-center mb-1 ${player.isEliminated ? 'bg-gray-600' : player.isSpy ? 'bg-accent/40' : 'bg-secondary/40'}">
                        ${player.id + 1}
                    </div>
                    <span class="text-sm">${player.name}</span>
                `;
                
                elements.playersList.appendChild(playerElement);
            });
        }
        
        // æ›´æ–°æŠ•ç¥¨åˆ—è¡¨
        function updateVotingList() {
            elements.votingList.innerHTML = '';
            
            gameData.players.forEach(player => {
                if (!player.isEliminated) {
                    const voteElement = document.createElement('div');
                    voteElement.className = `
                        flex flex-col items-center justify-center p-3 rounded-lg text-center card-hover cursor-pointer
                        bg-secondary/20 hover:bg-secondary/40 transition-colors
                    `;
                    
                    voteElement.innerHTML = `
                        <div class="w-10 h-10 rounded-full flex items-center justify-center mb-1 bg-secondary/40">
                            ${player.id + 1}
                        </div>
                        <span class="text-sm">${player.name}</span>
                    `;
                    
                    voteElement.addEventListener('click', () => {
                        // æ¸…é™¤å…¶ä»–é€‰ä¸­çŠ¶æ€
                        document.querySelectorAll('#voting-list > div').forEach(el => {
                            el.classList.remove('ring-2', 'ring-accent', 'bg-secondary/40');
                        });
                        
                        // è®¾ç½®å½“å‰é€‰ä¸­çŠ¶æ€
                        voteElement.classList.add('ring-2', 'ring-accent', 'bg-secondary/40');
                        
                        // å¯ç”¨æäº¤æŒ‰é’®
                        elements.submitVote.disabled = false;
                        
                        // å­˜å‚¨å½“å‰é€‰æ‹©çš„å€™é€‰äººIDï¼ˆä½¿ç”¨dataå±æ€§ï¼‰
                        voteElement.setAttribute('data-candidate-id', player.id);
                    });
                    
                    elements.votingList.appendChild(voteElement);
                }
            });
        }
        
        // å¤„ç†æŠ•ç¥¨ï¼ˆé›†ä½“æŠ•ç¥¨æœºåˆ¶ï¼‰
        function processVote() {
            // è·å–é€‰ä¸­çš„å€™é€‰äººID
            const selectedElement = document.querySelector('#voting-list > div.ring-2');
            if (!selectedElement) return;
            
            const candidateId = parseInt(selectedElement.getAttribute('data-candidate-id'));
            
            // æ·»åŠ æŠ•ç¥¨
            gameData.votes.push({
                candidateId: candidateId
            });
            
            // æ›´æ–°æŠ•ç¥¨è¿›åº¦
            updateVoteProgress();
            
            // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰æœªæ·˜æ±°çš„ç©å®¶éƒ½å·²æŠ•ç¥¨
            const remainingPlayers = gameData.players.filter(p => !p.isEliminated).length;
            
            if (gameData.votes.length < remainingPlayers) {
                // è¿˜æœ‰ç©å®¶æœªæŠ•ç¥¨ï¼Œé‡ç½®ç•Œé¢
                elements.submitVote.disabled = true;
                updateVotingList();
                
                // æç¤ºä¼ é€’è®¾å¤‡ç»™ä¸‹ä¸€ä½ç©å®¶
                alert(`å·²è®°å½•1ç¥¨ï¼Œè¿˜å‰©${remainingPlayers - gameData.votes.length}ç¥¨ï¼Œè¯·å°†è®¾å¤‡ä¼ ç»™ä¸‹ä¸€ä½ç©å®¶ç»§ç»­æŠ•ç¥¨`);
            } else {
                // æ‰€æœ‰ç©å®¶éƒ½å·²æŠ•ç¥¨ï¼Œç»Ÿè®¡ç»“æœ
                const voteCounts = {};
                gameData.votes.forEach(vote => {
                    voteCounts[vote.candidateId] = (voteCounts[vote.candidateId] || 0) + 1;
                });
                
                // è·å–æ‰€æœ‰å¾—ç¥¨æ•°
                const voteValues = Object.values(voteCounts);
                const maxVotes = Math.max(...voteValues);
                
                // æ£€æŸ¥æ˜¯å¦æœ‰å¹³å±€ï¼ˆå¤šä¸ªç©å®¶è·å¾—æœ€é«˜ç¥¨æ•°ï¼‰
                const topCandidates = Object.keys(voteCounts).filter(id => voteCounts[id] === maxVotes);
                
                if (topCandidates.length > 1) {
                    // å‡ºç°å¹³å±€ï¼Œéœ€è¦é‡æ–°æŠ•ç¥¨
                    showTieVoteScreen();
                } else {
                    // æ‰¾å‡ºå¾—ç¥¨æœ€å¤šçš„ç©å®¶
                    const eliminatedPlayerId = parseInt(topCandidates[0]);
                    
                    // æ‰¾åˆ°è¢«æ·˜æ±°çš„ç©å®¶
                    const eliminatedPlayerIndex = gameData.players.findIndex(p => p.id === eliminatedPlayerId);
                    gameData.players[eliminatedPlayerIndex].isEliminated = true;
                    gameData.eliminatedPlayers.push(gameData.players[eliminatedPlayerIndex]);
                    
                    // æ˜¾ç¤ºæŠ•ç¥¨ç»“æœ
                    showVoteResultScreen(gameData.players[eliminatedPlayerIndex], voteCounts);
                }
            }
        }
        
        // æ˜¾ç¤ºè¢«æ·˜æ±°ç©å®¶çš„èº«ä»½
        function showEliminatedRole() {
            document.getElementById('role-reveal').style.display = 'block';
            elements.showEliminatedRole.disabled = true;
            elements.showEliminatedRole.classList.add('opacity-50', 'cursor-not-allowed');
        }
        
        // æ£€æŸ¥æ¸¸æˆçŠ¶æ€ï¼ˆæ˜¯å¦ç»“æŸï¼‰
        function checkGameStatus() {
            // å¦‚æœæ˜¯å¹³å±€åçš„é‡æ–°æŠ•ç¥¨
            if (elements.continueGame.textContent.trim() === 'é‡æ–°æŠ•ç¥¨') {
                showVoteScreen();
                return;
            }
            
            // è®¡ç®—å‰©ä½™çš„å¹³æ°‘å’Œå§åº•æ•°é‡
            const remainingCivilians = gameData.players.filter(p => !p.isSpy && !p.isEliminated).length;
            const remainingSpies = gameData.players.filter(p => p.isSpy && !p.isEliminated).length;
            
            // æ£€æŸ¥æ¸¸æˆæ˜¯å¦ç»“æŸ
            if (remainingSpies === 0) {
                // å¹³æ°‘èƒœåˆ©
                showEndScreen(false);
            } else if (remainingSpies >= remainingCivilians) {
                // å§åº•èƒœåˆ©
                showEndScreen(true);
            } else {
                // æ¸¸æˆç»§ç»­
                showGameScreen();
            }
        }
        
        // é‡æ–°å¼€å§‹æ¸¸æˆ
        function restartGame() {
            hideAllScreens();
            elements.startScreen.classList.remove('hidden');
            
            // æ·»åŠ å…¥åœºåŠ¨ç”»
            elements.startScreen.classList.add('animate-fadeIn');
            setTimeout(() => {
                elements.startScreen.classList.remove('animate-fadeIn');
            }, 500);
        }
        
        // æ‰“ä¹±æ•°ç»„é¡ºåºï¼ˆFisher-Yatesç®—æ³•ï¼‰
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        
        // æ·»åŠ ç®€å•çš„åŠ¨ç”»æ ·å¼
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(20px); }
                to { opacity: 1; transform: translateY(0); }
            }
            .animate-fadeIn {
                animation: fadeIn 0.5s ease-out forwards;
            }
            #player-word {
                transition: opacity 0.3s ease;
            }
            #player-word.opacity-0 {
                opacity: 0;
            }
        `;
        document.head.appendChild(style);
        
        // åˆå§‹åŒ–åº”ç”¨
        function init() {
            initEventListeners();
        }
        
        // å¯åŠ¨åº”ç”¨
        init();
    </script>
</body>
</html>
